---
title: "Nutrition Cailles"
author: "zco"
date: "24/06/2021"
output: html_document
---


# ANOVA à mesures répétées avec R

## Librairies

```{r message = FALSE, warning = FALSE}
library("tidyverse") # tidy et ggplot2
library("ggpubr")    # ggboxplot()
library("agricolae") # SNK.test() Student Newman-Keuls
library("car")       # leveneTest() or levene_test()
library("rstatix")   # convert_as_factor()
```

## Données

```{r}
mg <- read_csv("data/mg.csv")
mg <- mg %>% convert_as_factor(regime)
```

Rassembler les colonnes mg1 à mg4 en format long et convertir l'identifiant et le temps en facteurs

```{r}
mgl <- mg %>%
  mutate(id = 1:nrow(mg)) %>% 
  gather(key = "seance", value = "tmg", -c(regime, reference, id)) %>%
  convert_as_factor(id, seance)
head(mgl)
```

## Sommaire des données

```{r}
mgl %>%
  group_by(seance) %>%
  get_summary_stats(tmg, type = "mean_sd")
```

## Visualisation boxplots

```{r}
ggboxplot(mgl, x = "seance", y = "tmg")#, add = "point")
```

## Détection valeurs aberrantes

```{r}
out_mgl <- mgl %>%
  group_by(seance) %>%
  identify_outliers(tmg)
out_mgl
```

## Normalité

Si les données sont normalement distribuées, la p-value de Shapiro-Wilk doit être supérieure à 0,05.

```{r}
mgl %>%
  group_by(seance) %>%
  shapiro_test(tmg)
```

> Toutes les distributions sont normales.

NB. Si la taille de l'échantillon est supérieure à 50, le graphique de normalité QQ-plot est préféré parce qu’avec des échantillons de plus grande taille, le test de Shapiro-Wilk devient très sensible même à un écart mineur par rapport à la distribution normale.

Le graphique QQ-plot dessine la corrélation entre une donnée définie et la distribution normale. Ce n'est pas le cas ici mais je le fais quand même.

Créer des QQ-plots pour chaque point par séance

```{r}
ggqqplot(mgl, "tmg", facet.by = "seance")
```

Tous les points se situent approximativement le long de la ligne de référence, nous pouvons supposer une normalité.

## Sphéricité

```{r}
mgl %>%
  select(seance, regime, tmg) %>% 
  group_by(seance) %>%
  levene_test(tmg ~ regime)
```

> Les variances sont homogènes


## Sphéricité et ANOVA, mesures repétées

La fonction `anova_test()` réalise également le test de sphéricité de Mauchly.

```{r}
res_anova <- anova_test(data = mgl,      #
                        dv = tmg,        # dependant variable, num
                        wid = id,        # identificateur de cas/échantillon (facteur)
                        within = seance) # facteur de groupement intra-sujets
get_anova_table(res_anova)
```

"ges" est la taille de l’effet généralisé (taille de la variabilité due au facteur intra-sujets)

> Différence entre au moins 2 séances

## Test post-hoc, mesures repétées

```{r}
tph <- mgl %>%
  pairwise_t_test(tmg ~ seance, 
                  paired = TRUE,
                  p.adjust.method = "bonferroni")

tph %>% 
  select(group1, group2, p, p.adj, p.adj.signif)
```

```{r}
mgl %>%
  group_by(seance) %>%
  get_summary_stats(tmg, type = "mean_sd")
```

> séeance 1 ≠ séance 2
>
> séance 1 ≠ séance 3
>
> séance 1 ≠ séance 4
>
> séance 2 ≠ séance 4
>
> séance 2 ≈ séance 3
>
> séance 3 ≈ séance 4.

